#### 客户端存储

Cookie

1. 客户端写`Cookie`

   `Expires` —— 设置`Cookie`的有效期，绝对日期

   `Max-Age`——设置相对日期

   `HttpOnly`——不能使用`JS`脚本访问`Cookie`

   `Secure`——一个带有安全属性的`cookie`，只有在`SSl`和`Https`协议才能发送到服务器

   `Domain`——`Cookie`可以发送到的主机名

   `Path`——指定一个`URL`路径

   `SameSite`——允许服务器设置`Cookie`，不随跨域请求发送

2. 同站和同源

   > 同源：协议+域名+端口号
   >
   > 同站：有效的顶级域名+二级域名，不考虑端口和协议

3. `SameSite`跨站请求`Cookie`

   > 默认值为`Lax`
   >
   > 当请求类型为链接、预加载或者`get`表单时默认携带`Cookie`
   >
   > 注意事项：`SameSite`和`Secure`同时设置，前端和后端站点都为`https`

Web Storage——遵循同源策略

1. `SessionStorage` 

   > 不是共享的！！！
   >
   > 在新标签页或者窗口打开一个页面时会复制顶级浏览会话的上下文作为新的会话上下文
   >
   > 但也仅仅是复制，并不会同步更改

2. `SessionStorage` 能否触发`StorageEvent`事件

   > `a`标签打开——不触发
   >
   > `iframe`嵌套——可以触发
   >
   > 如何区分谁触发的`StorageEvent`——`e.storageArea === sessionStorage`

3. `locationStorage`

   > 如何支持过期
   >
   > * 添加一个属性，记住过期时间
   > * 添加数据时，将过期时间也进行保存
   > * 查询数据时，对比时间，过期则删除
   >
   > 存储加密
   >
   > * 简单加密
   >   * URL方式：`encodeURIComponent` + `decodeURIComponent`
   >   * base64：`window.btoa` + `window.atob`
   > * 复杂加密
   >   * 浏览器提供的`web Crypto API`的`SubtleCrypto`接口
   >   * 第三方库：`secure-js`和`localstorage-slim`

4. 存储空间

   > 采用`utf-16`格式编码键值对——使用**两个字节**为单位进行编码——1个字节等于8个`bit`
   >
   > `5M`——指`5M`个`utf-16`的编码单元——`5M * 1024 * 1024`

IndexDB

1. 什么是`IndexDB`

   > 一个事物型的数据库系统
   >
   > 基于`js`的面向对象数据库——存储对象——支持索引
   >
   > 可以存储**结构化克隆算法**支持的任何对象

2. 不能被结构化克隆算法复制的数据

   > `Error`以及`Function`对象
   >
   > `Dom`节点
   >
   > 属性描述符——`setters`以及`getters`
   >
   > 原型链上的属性

3. 特点

   > 以键值对存储，键可以是二进制对象
   >
   > 支持事物
   >
   > 遵循同源策略
   >
   > 基于回调的异步操作
   >
   > 存储空间大，配额很大
   >
   > 支持直接存储二进制数据

4. 基本流程

   > 打开数据库
   >
   > 在数据库创建/打开一个对象仓库
   >
   > 启动一个事务并发送请求来执行数据库的一些操作，增加或提取数据
   >
   > 通过监听事件来等待操作完成

5. 应用场景

   > 缓存数据，如游戏数据
   >
   > 缓存图片、脚本、`json`文件等静态资源
   >
   > `service worker`的第三方库——`indexDB`存储

浏览器存储

* `Cookie`

  > 单个`cookie`大小一般为`4KB`——4069个字节
  >
  > 默认采用`utf-8`存储
  >
  > 遵循同站策略
  >
  > 同一域名下存放个数有限，一般为20-30个，不同浏览器不同
  >
  > 存储分为会话期存储和持久性存储
  >
  > 会通过请求携带

* `localStorage`

  > 总大小：10MB
  >
  > 同源共享数据
  >
  > 存储为`utf-16`编码
  >
  > 不存在过期
  >
  > 数据操作同步

* `sessionStorage`

  > 总大小：10MB
  >
  > 存储为`utf-16`编码
  >
  > 浏览器关闭，数据消失
  >
  > 数据操作同步

* `indexDB`

  > 存储空间大
  >
  > 同源策略
  >
  > 支持二进制存储，不仅仅文本字符串
  >
  > 不存在过期
  >
  > 数据操作异步

* `Cache API 与 service worker`

  > 提升二次请求的加载速度
  >
  > 首次请求时会将文件缓存到`Cache`中，当再次请求相关资源时直接返回存在的资源而不用再次发送网络请求，提升二次请求的速度也被用于离线应用中

* `FileSystem`——浏览器中的文件系统